<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>RB Visualizations</title>
		
		<script type="text/javascript" src="d3/d3.v3.js"></script>
		<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" type="text/css" href="main.css">
		<script>
			var _gaq = _gaq || [];
			var pluginUrl = '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
			_gaq.push(['_require', 'inpage_linkid', pluginUrl]);
			_gaq.push(['_setAccount', 'UA-40368986-4']);
			_gaq.push(['_trackPageview']);

			(function() {
				var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
				ga.src = ('https:' == document.location.protocol ? 'http://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
			})();
		</script>
	</head>
<!--	<body>
		<h1> Running Back Visualization</h1>
			<p> 
				Hello! This is a beta preview of my newest data visualization for RBs. 
				This particular graph shows a RB's fantasy points vs. the amount of targets
				he gets, although there are <a href="http://claymcleod.github.io/blog/articles/week8-rb/">a few more</a>.
				Please let me know what you think! (Click the buttons to make the graph change)
			</p>-->
		<center>
		  <h2><a href="http://claymcleod.github.io/fflconsole/">Back to FFL Console</a></h2>
			<select id="x_select" style="display: none;"></select>
			<select id="y_select" style="display: none;"></select>
			<button type="button" onclick="rotateX()">Rotate X Axis</button>
			<button type="button" onclick="rotateY()">Rotate Y Axis</button>
		</center>
		<script type="text/javascript">

		var headers = ["Name","Attempts","Yards","Tds","Fumbles","YPC","Fantasy Points"]	
		var data = [
		["Matt Forte",147,616,3,3,4.19,147.30] ,
["Arian Foster",161,822,7,3,5.11,161.10] ,
["Le'Veon Bell",162,747,1,2,4.61,139.30] ,
["Marshawn Lynch",153,689,9,3,4.50,163.50] ,
["Jamaal Charles",113,533,6,2,4.72,110.20] ,
["LeSean McCoy",173,642,2,0,3.71,81.40] ,
["Eddie Lacy",119,478,4,1,4.02,101.50] ,
["Mark Ingram",115,551,6,0,4.79,97.80] ,
["Alfred Morris",152,605,6,0,3.98,99.30] ,
["Andre Ellington",167,582,3,2,3.49,117.40] ,
["Ahmad Bradshaw",83,421,2,6,5.07,115.40] ,
["Frank Gore",139,553,2,1,3.98,81.20] ,
["Shane Vereen",69,310,1,3,4.49,79.60] ,
["Terrance West",107,396,3,1,3.70,67.50] ,
["Jeremy Hill",86,404,5,0,4.70,83.00] ,
["Steven Jackson",111,426,4,0,3.84,74.00] ,
["Giovani Bernard",109,446,5,0,4.09,92.50] ,
["Jerick McKinnon",90,446,0,0,4.96,55.20] ,
["Trent Richardson",108,391,2,0,3.62,65.30] ,
["Rashad Jennings",91,396,2,0,4.35,60.50] ,
["Ryan Mathews",23,71,1,0,3.09,15.70] ,
["Joique Bell",108,357,3,0,3.31,67.10] ,
["Fred Jackson",58,249,1,1,4.29,62.90] ,
["C.J. Anderson",30,172,0,1,5.73,33.90] ,
["Lamar Miller",110,528,5,1,4.80,96.80] ,
["Bishop Sankey",92,360,1,0,3.91,50.30] ,
["Bobby Rainey",87,388,1,1,4.46,70.40] ,
["Ben Tate",104,342,4,0,3.29,64.20] ,
["Darren Sproles",34,228,3,0,6.71,63.20] ,
["Tre Mason",63,270,1,0,4.29,34.80] ,
["Jonathan Stewart",66,263,1,0,3.98,40.80] ,
["Darren McFadden",105,372,2,0,3.54,65.50] ,
["Charles Sims",8,23,0,0,2.88,2.00] ,
["Reggie Bush",53,191,1,0,3.60,42.00] ,
["DeAngelo Williams",33,126,0,0,3.82,15.60] ,
["Montee Ball",55,172,1,0,3.13,27.40] ,
["Andre Williams",114,335,4,0,2.94,60.90] ,
["Matt Asiata",84,277,6,1,3.30,87.60] ,
["Branden Oliver",98,371,2,1,3.79,72.00] ,
["Bryce Brown",14,50,0,0,3.57,9.50] ,
["Jonas Gray",32,131,0,0,4.09,13.10] ,
["Isaiah Crowell",64,297,5,0,4.64,57.30] ,
["Benny Cunningham",48,185,3,1,3.85,60.80] ,
["Anthony Dixon",58,243,0,0,4.19,25.80] ,
["Damien Williams",31,100,0,0,3.23,16.20] ,
["Peyton Hillis",26,115,0,0,4.42,20.20] ,
["Travaris Cadet",8,27,0,1,3.38,28.80] ,
["Carlos Hyde",54,214,3,0,3.96,41.10] ,
["Juwan Thompson",30,121,3,0,4.03,28.70] ,
["Pierre Thomas",30,133,2,1,4.43,51.70] ,

		]
		var x_axis_columns = [1, 2, 3, 4, 5, 6] // Must always be ascending order of columns for label indexing!
		var y_axis_columns = [1, 2, 3, 4, 5, 6] // Must always be ascending order of columns for label indexing!
		var current_x_axis = 5
		var current_y_axis = 0
		
		var padding = 30;
		var width_of_svg = 1000;
		var height_of_svg = 600;
		
		// Setup
		
		var select = document.getElementById("x_select");
		
		for(var i = 0; i < headers.length; i++) {
    		var opt = headers[i];
    		var el = document.createElement("option");
    		el.textContent = opt;
    		el.value = opt;
    		select.appendChild(el);
		}	
		
		var select = document.getElementById("y_select");
		
		for(var i = 0; i < y_axis_columns.length; i++) {
    		var opt = headers[y_axis_columns[i]];
    		var el = document.createElement("option");
    		el.textContent = opt;
    		el.value = opt;
    		select.appendChild(el);
		}	

		// Calculations
		
		var array = create_scatterplot(data, "Attempts vs. Fantasy Points", 1, "Targets", 6, "Fantasy Points (Standard)")
		var circles = array[0]
		var svg = array[1]
		
		// FUNCTIONS
		
		function create_scatterplot(data, title, x_axis_column, x_label, y_axis_column, y_label) {
			
	
			
			//Create scale functions
			var xScale = d3.scale.linear()
								 .domain([d3.min(data, function(d) { return d[x_axis_column]; }) - 5, d3.max(data, function(d) { return d[x_axis_column]; }) + 5])
								 .range([padding, width_of_svg - padding * 2]);

			var yScale = d3.scale.linear()
								 .domain([d3.min(data, function(d) { return d[y_axis_column]; }) - 5, d3.max(data, function(d) { return d[y_axis_column]; }) + 5])
								 .range([height_of_svg - padding, padding]);

			var rScale = d3.scale.linear()
								 .domain([1, data.length])
								 .range([20, 3]);
								 
			var colorScale = d3.scale.linear()
								 .domain([1, data.length / 2, data.length])
								 .range(["red", "orange", "green"]);

			//Define X axis
			var xAxis = d3.svg.axis()
							  .scale(xScale)
							  .orient("bottom")
							  .ticks(5);

			//Define Y axis
			var yAxis = d3.svg.axis()
							  .scale(yScale)
							  .orient("left")
							  .ticks(5);
			
			
			var svg = d3.select("body")
				.append("svg")
				.style("display", "block")
				.style("width", width_of_svg + "px") 
				.style("height", height_of_svg + "px")
				.style("margin-left", "auto")
				.style("margin-right", "auto")
				.style("padding-bottom", "55px");
			
			svg.append("text")
				.attr("x", (width_of_svg / 2))			   
				.attr("y", 45)
				.attr("text-anchor", "middle")	
				.style("font-size", "36px") 
				.style("font-family", "Baskerville, \"Times New Roman\", serif")
				.text(title);
				
			var tooltip = d3.select("body")
				.append("div")
				.style("position", "absolute")
				.style("z-index", "10")
				.style("visibility", "hidden")
				.style("font-size", "16px")
				.style("font-family", "Baskerville, \"Times New Roman\", serif")
				.text("");
			
			var circles = svg.selectAll("circle")
			   .data(data)
			   .enter()
			   .append("circle")
			   .attr("cx", function(d) {
					return xScale(d[x_axis_column]);
			   })
			   .attr("cy", function(d) {
					return yScale(d[y_axis_column]);
			   })
			   .attr("r", function(d, i) {
					return rScale(i);
			   })
			   .attr("fill", function(d, i) {
					return colorScale(i);
			   })
			   .attr("stroke", "black")
			   .attr("stroke-width", 1)
			   .on("mouseover", function(d) {	   
					d3.select(this).transition()		
					.duration(200)		
					.style("opacity", 1);  
					return tooltip.style("visibility", "visible");	 
			})	 
			.on("mousemove", function(d, i){
				var name = data[i][0]
				return tooltip.text(name).style("top", (event.pageY-10)+"px").style("left",(event.pageX+10)+"px");
			})				 
			.on("mouseout", function(d) {  
				d3.select(this).transition()		
					.duration(200)		
					.style("opacity", .35); 
				return tooltip.style("visibility", "hidden");	
			});
			   
			svg.append("g")
				.attr("class", "axis")
				.attr("transform", "translate(0," + (height_of_svg - padding) + ")")
				.call(xAxis);
			
			svg.append("g")
				.attr("class", "axis")
				.attr("transform", "translate(" + padding + ",0)")
				.call(yAxis);
				
			svg.append("text")
				.attr("text-anchor", "end")
				.attr("x", width_of_svg - 68)
				.attr("y", height_of_svg - 38)
				.text(x_label);
	
			svg.append("text")
				.attr("text-anchor", "end")
				.attr("x", -38)
				.attr("y", 38)
				.attr("dy", ".75em")
				.attr("transform", "rotate(-90)")
				.text(y_label);
	
			circles.transition()
				 .duration(3000)
				 .style("opacity", 0.35);
				 
			return [circles, svg];
		}
		
		function renderNextVisualization() {
			var i = current_y_axis;
				
			//Create scale functions
			var xScale = d3.scale.linear()
								 .domain([d3.min(data, function(d) { return d[x_axis_columns[current_x_axis]]; }) - 5, d3.max(data, function(d) { return d[x_axis_columns[current_x_axis]]; }) + 5])
								 .range([padding, width_of_svg - padding * 2]);

			var yScale = d3.scale.linear()
								 .domain([d3.min(data, function(d) { return d[y_axis_columns[current_y_axis]]; }) - 5, d3.max(data, function(d) { return d[y_axis_columns[current_y_axis]]; }) + 5])
								 .range([height_of_svg - padding, padding]);

			var rScale = d3.scale.linear()
								 .domain([1, data.length])
								 .range([20, 3]);
								 
			var colorScale = d3.scale.linear()
								 .domain([1, data.length / 2, data.length])
								 .range(["red", "orange", "green"]);

			//Define X axis
			var xAxis = d3.svg.axis()
							  .scale(xScale)
							  .orient("bottom")
							  .ticks(5);

			//Define Y axis
			var yAxis = d3.svg.axis()
							  .scale(yScale)
							  .orient("left")
							  .ticks(5);
			
			svg.selectAll("g").remove()
			svg.selectAll("text").remove()
			svg.append("g")
				.attr("class", "axis")
				.attr("transform", "translate(0," + (height_of_svg - padding) + ")")
				.call(xAxis);
			
			svg.append("g")
				.attr("class", "axis")
				.attr("transform", "translate(" + padding + ",0)")
				.call(yAxis);
				
			svg.append("text")
				.attr("text-anchor", "end")
				.attr("x", width_of_svg - 68)
				.attr("y", height_of_svg - 38)
				.text(headers[x_axis_columns[0] + current_x_axis]);
	
			svg.append("text")
				.attr("text-anchor", "end")
				.attr("x", -38)
				.attr("y", 38)
				.attr("dy", ".75em")
				.attr("transform", "rotate(-90)")
				.text(headers[y_axis_columns[0] + current_y_axis]);
			
			svg.append("text")
				.attr("x", (width_of_svg / 2))			   
				.attr("y", 45)
				.attr("text-anchor", "middle")	
				.style("font-size", "36px") 
				.style("font-family", "Baskerville, \"Times New Roman\", serif")
				.text(headers[x_axis_columns[current_x_axis]] +" vs. "+headers[y_axis_columns[0] + current_y_axis]);
						
			circles.transition()
				.attr("cx", function(d, i) {
  					return xScale(data[i][x_axis_columns[current_x_axis]]);
  				})
  				.attr("cy", function(d, i) {
  					return yScale(data[i][y_axis_columns[current_y_axis]]);
  				})
  				.duration(1000) // this is 1s
  				.delay(100)     // this is 0.1s	
		
			return i;
		}
		
		function rotateX() {
			current_x_axis = current_x_axis + 1;
			
			if (current_x_axis == current_y_axis) {
				current_x_axis = current_x_axis + 1
			}
			
			if(current_x_axis > (x_axis_columns.length - 1)) {
				current_x_axis = 0;
			}
			
			if (current_x_axis == current_y_axis) {
				current_x_axis = current_x_axis + 1
			}
			renderNextVisualization()
		}
		
		function rotateY() {
			current_y_axis = current_y_axis + 1;
			
			if (current_x_axis == current_y_axis) {
				current_y_axis = current_y_axis + 1
			}
			
			if(current_y_axis > (y_axis_columns.length - 1)) {
				current_y_axis = 0;
			}
			
			if (current_x_axis == current_y_axis) {
				current_y_axis = current_y_axis + 1
			}
			
			renderNextVisualization()
		}

		</script>
	</body>
</html>
