<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>WR Visualizations</title>
		
		<script type="text/javascript" src="d3/d3.v3.js"></script>
		<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" type="text/css" href="main.css">
		<script>
			var _gaq = _gaq || [];
			var pluginUrl = '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
			_gaq.push(['_require', 'inpage_linkid', pluginUrl]);
			_gaq.push(['_setAccount', 'UA-40368986-4']);
			_gaq.push(['_trackPageview']);

			(function() {
				var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
				ga.src = ('https:' == document.location.protocol ? 'http://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
			})();
		</script>
	</head>
	<body>
<!--		<h1> Wide Receiver Visualization</h1>
			<p> 
				Hello! This is a beta preview of my newest data visualization for WRs. 
				This particular graph shows a WR's fantasy points vs. the amount of targets
				he gets, although there are <a href="http://claymcleod.github.io/blog/articles/week8-wr/">a few more</a>.
				Please let me know what you think! (Click the buttons to make the graph change)
			</p>-->
		<center>
		  <h2><a href="http://claymcleod.github.io/fflconsole/">Back toFFL Console</a></h2>
			<select id="x_select" style="display: none;"></select>
			<select id="y_select" style="display: none;"></select>
			<button type="button" onclick="rotateX()">Rotate X Axis</button>
			<button type="button" onclick="rotateY()">Rotate Y Axis</button>
		</center>
		<script type="text/javascript">
		/*	   
			var data = d3.csv("wr_visualization.csv", function(player)
			{
				console.log("Player:", player)
				data = player.map(function(d)
				{
					console.log(d)
					return {
						"Name":d.Name, "Targets":+d.Targets, "YPC":+d.YPC
					}
				})
				
				return data
			})
		*/
		var headers = ["Name", "Targets", "Receptions", "Yards", "TDs", "YPC", "Fantasy Points"]
		
		var data = [
		           ["Demaryius Thomas",87,54,894,6,16.56,125.40] ,
["Antonio Brown",103,71,996,8,14.03,147.60] ,
["Jordy Nelson",78,50,737,6,14.74,109.70] ,
["Julio Jones",83,53,734,3,13.85,91.40] ,
["Calvin Johnson",37,22,348,2,15.82,46.80] ,
["Randall Cobb",55,40,578,9,14.45,111.80] ,
["Dez Bryant",86,50,635,6,12.70,99.50] ,
["Jeremy Maclin",83,45,790,8,17.56,127.00] ,
["A.J. Green",31,20,358,3,17.90,53.80] ,
["Emmanuel Sanders",76,57,785,4,13.77,102.50] ,
["Brandon Marshall",66,34,384,5,11.29,68.40] ,
["Alshon Jeffery",61,38,563,3,14.82,74.30] ,
["Sammy Watkins",67,38,590,5,15.53,89.00] ,
["Kelvin Benjamin",78,40,589,5,14.72,88.90] ,
["Golden Tate",80,55,800,3,14.55,98.00] ,
["Roddy White",61,33,419,3,12.70,59.90] ,
["Mohamed Sanu",66,39,628,4,16.10,86.80] ,
["Vincent Jackson",77,32,443,2,13.84,56.30] ,
["Mike Wallace",67,35,468,5,13.37,76.80] ,
["Larry Fitzgerald",55,35,513,2,14.66,63.30] ,
["Steve Smith",77,46,711,4,15.46,95.10] ,
["Mike Evans",53,32,460,4,14.38,70.00] ,
["Percy Harvin",26,22,133,0,6.05,13.30] ,
["Martavis Bryant",17,10,167,5,16.70,46.70] ,
["Eric Decker",64,40,426,4,10.65,66.60] ,
["Michael Floyd",48,23,389,2,16.91,50.90] ,
["Brandin Cooks",54,43,410,2,9.53,53.00] ,
["Torrey Smith",48,22,371,5,16.86,67.10] ,
["Anquan Boldin",62,45,540,2,12.00,66.00] ,
["Terrance Williams",46,27,426,6,15.78,78.60] ,

			  ];
			
		var x_axis_columns = [1, 2, 3, 4, 5, 6] // Must always be ascending order of columns for label indexing!
		var y_axis_columns = [1, 2, 3, 4, 5, 6] // Must always be ascending order of columns for label indexing!
		var current_x_axis = 5
		var current_y_axis = 0
		
		var padding = 30;
		var width_of_svg = 1000;
		var height_of_svg = 600;
		
		// Setup
		
		var select = document.getElementById("x_select");
		
		for(var i = 0; i < headers.length; i++) {
    		var opt = headers[i];
    		var el = document.createElement("option");
    		el.textContent = opt;
    		el.value = opt;
    		select.appendChild(el);
		}	
		
		var select = document.getElementById("y_select");
		
		for(var i = 0; i < y_axis_columns.length; i++) {
    		var opt = headers[y_axis_columns[i]];
    		var el = document.createElement("option");
    		el.textContent = opt;
    		el.value = opt;
    		select.appendChild(el);
		}	

		// Calculations
		var array = create_scatterplot(data, "Targets vs. Fantasy Points", 1, "Targets", 6, "Fantasy Points (Standard)")
		var circles = array[0]
		var svg = array[1]
		//create_scatterplot(data, "Targets vs. Yards", 1, "Targets", 3, "Yards")
		//create_scatterplot(data, "YPC vs. Fantasy Points", 5, "Yards Per Catch", 6, "Fantasy Points (Standard)")
		
		// FUNCTIONS
		
		function create_scatterplot(data, title, x_axis_column, x_label, y_axis_column, y_label) {
			
	
			
			//Create scale functions
			var xScale = d3.scale.linear()
								 .domain([d3.min(data, function(d) { return d[x_axis_column]; }) - 5, d3.max(data, function(d) { return d[x_axis_column]; }) + 5])
								 .range([padding, width_of_svg - padding * 2]);

			var yScale = d3.scale.linear()
								 .domain([d3.min(data, function(d) { return d[y_axis_column]; }) - 5, d3.max(data, function(d) { return d[y_axis_column]; }) + 5])
								 .range([height_of_svg - padding, padding]);

			var rScale = d3.scale.linear()
								 .domain([1, data.length])
								 .range([20, 3]);
								 
			var colorScale = d3.scale.linear()
								 .domain([1, data.length / 2, data.length])
								 .range(["red", "orange", "green"]);

			//Define X axis
			var xAxis = d3.svg.axis()
							  .scale(xScale)
							  .orient("bottom")
							  .ticks(5);

			//Define Y axis
			var yAxis = d3.svg.axis()
							  .scale(yScale)
							  .orient("left")
							  .ticks(5);
			
			
			var svg = d3.select("body")
				.append("svg")
				.style("display", "block")
				.style("width", width_of_svg + "px") 
				.style("height", height_of_svg + "px")
				.style("margin-left", "auto")
				.style("margin-right", "auto")
				.style("padding-bottom", "55px");
			
			svg.append("text")
				.attr("x", (width_of_svg / 2))			   
				.attr("y", 45)
				.attr("text-anchor", "middle")	
				.style("font-size", "36px") 
				.style("font-family", "Baskerville, \"Times New Roman\", serif")
				.text(title);
				
			var tooltip = d3.select("body")
				.append("div")
				.style("position", "absolute")
				.style("z-index", "10")
				.style("visibility", "hidden")
				.style("font-size", "16px")
				.style("font-family", "Baskerville, \"Times New Roman\", serif")
				.text("");
			
			var circles = svg.selectAll("circle")
			   .data(data)
			   .enter()
			   .append("circle")
			   .attr("cx", function(d) {
					return xScale(d[x_axis_column]);
			   })
			   .attr("cy", function(d) {
					return yScale(d[y_axis_column]);
			   })
			   .attr("r", function(d, i) {
					return rScale(i);
			   })
			   .attr("fill", function(d, i) {
					return colorScale(i);
			   })
			   .attr("stroke", "black")
			   .attr("stroke-width", 1)
			   .on("mouseover", function(d) {	   
					d3.select(this).transition()		
					.duration(200)		
					.style("opacity", 1);  
					return tooltip.style("visibility", "visible");	 
			})	 
			.on("mousemove", function(d, i){
				var name = data[i][0]
				return tooltip.text(name).style("top", (event.pageY-10)+"px").style("left",(event.pageX+10)+"px");
			})				 
			.on("mouseout", function(d) {  
				d3.select(this).transition()		
					.duration(200)		
					.style("opacity", .35); 
				return tooltip.style("visibility", "hidden");	
			});
			   
			svg.append("g")
				.attr("class", "axis")
				.attr("transform", "translate(0," + (height_of_svg - padding) + ")")
				.call(xAxis);
			
			svg.append("g")
				.attr("class", "axis")
				.attr("transform", "translate(" + padding + ",0)")
				.call(yAxis);
				
			svg.append("text")
				.attr("text-anchor", "end")
				.attr("x", width_of_svg - 68)
				.attr("y", height_of_svg - 38)
				.text(x_label);
	
			svg.append("text")
				.attr("text-anchor", "end")
				.attr("x", -38)
				.attr("y", 38)
				.attr("dy", ".75em")
				.attr("transform", "rotate(-90)")
				.text(y_label);
	
			circles.transition()
				 .duration(3000)
				 .style("opacity", 0.35);
				 
			return [circles, svg];
		}
		
		function renderNextVisualization() {
			var i = current_y_axis;
				
			//Create scale functions
			var xScale = d3.scale.linear()
								 .domain([d3.min(data, function(d) { return d[x_axis_columns[current_x_axis]]; }) - 5, d3.max(data, function(d) { return d[x_axis_columns[current_x_axis]]; }) + 5])
								 .range([padding, width_of_svg - padding * 2]);

			var yScale = d3.scale.linear()
								 .domain([d3.min(data, function(d) { return d[y_axis_columns[current_y_axis]]; }) - 5, d3.max(data, function(d) { return d[y_axis_columns[current_y_axis]]; }) + 5])
								 .range([height_of_svg - padding, padding]);

			var rScale = d3.scale.linear()
								 .domain([1, data.length])
								 .range([20, 3]);
								 
			var colorScale = d3.scale.linear()
								 .domain([1, data.length / 2, data.length])
								 .range(["red", "orange", "green"]);

			//Define X axis
			var xAxis = d3.svg.axis()
							  .scale(xScale)
							  .orient("bottom")
							  .ticks(5);

			//Define Y axis
			var yAxis = d3.svg.axis()
							  .scale(yScale)
							  .orient("left")
							  .ticks(5);
			
			svg.selectAll("g").remove()
			svg.selectAll("text").remove()
			svg.append("g")
				.attr("class", "axis")
				.attr("transform", "translate(0," + (height_of_svg - padding) + ")")
				.call(xAxis);
			
			svg.append("g")
				.attr("class", "axis")
				.attr("transform", "translate(" + padding + ",0)")
				.call(yAxis);
				
			svg.append("text")
				.attr("text-anchor", "end")
				.attr("x", width_of_svg - 68)
				.attr("y", height_of_svg - 38)
				.text(headers[x_axis_columns[0] + current_x_axis]);
	
			svg.append("text")
				.attr("text-anchor", "end")
				.attr("x", -38)
				.attr("y", 38)
				.attr("dy", ".75em")
				.attr("transform", "rotate(-90)")
				.text(headers[y_axis_columns[0] + current_y_axis]);
			
			svg.append("text")
				.attr("x", (width_of_svg / 2))			   
				.attr("y", 45)
				.attr("text-anchor", "middle")	
				.style("font-size", "36px") 
				.style("font-family", "Baskerville, \"Times New Roman\", serif")
				.text(headers[x_axis_columns[current_x_axis]] +" vs. "+headers[y_axis_columns[0] + current_y_axis]);
						
			circles.transition()
				.attr("cx", function(d, i) {
  					return xScale(data[i][x_axis_columns[current_x_axis]]);
  				})
  				.attr("cy", function(d, i) {
  					return yScale(data[i][y_axis_columns[current_y_axis]]);
  				})
  				.duration(1000) // this is 1s
  				.delay(100)     // this is 0.1s	
		
			return i;
		}
		
		function rotateX() {
			current_x_axis = current_x_axis + 1;
			
			if (current_x_axis == current_y_axis) {
				current_x_axis = current_x_axis + 1
			}
			
			if(current_x_axis > (x_axis_columns.length - 1)) {
				current_x_axis = 0;
			}
			
			if (current_x_axis == current_y_axis) {
				current_x_axis = current_x_axis + 1
			}
			renderNextVisualization()
		}
		
		function rotateY() {
			current_y_axis = current_y_axis + 1;
			
			if (current_x_axis == current_y_axis) {
				current_y_axis = current_y_axis + 1
			}
			
			if(current_y_axis > (y_axis_columns.length - 1)) {
				current_y_axis = 0;
			}
			
			if (current_x_axis == current_y_axis) {
				current_y_axis = current_y_axis + 1
			}
			
			renderNextVisualization()
		}

		</script>
	</body>
</html>
